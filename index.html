<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUIZ! OHTANISAN</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
        }
        h1 {
            font-size: 36px;
            margin-bottom: 20px;
        }
        p {
            font-size: 18px;
            margin-bottom: 20px;
        }
        #start-screen, #game-screen, #result-screen {
            display: none;
        }
        #start-screen {
            display: block;
        }
        #start-button {
            font-size: 24px;
            padding: 15px 30px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 20px;
        }
        #start-button:hover {
            background-color: #45a049;
        }
        #game-screen img, #result-screen img, #start-screen img {
            width: 300px;
            height: 300px;
            margin: 20px 0;
        }
        #choices button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        #timer {
            font-size: 24px;
            margin-top: 20px;
        }
        #back-to-start {
            font-size: 18px;
            padding: 10px 20px;
            background-color: #008CBA;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 20px;
        }
        #back-to-start:hover {
            background-color: #007399;
        }
    </style>
</head>
<body>
    <audio id="bgm" loop autoplay>
        <source src="bgm.mp3" type="audio/mpeg">
        あなたのブラウザはオーディオ要素をサポートしていません。
    </audio>

    <div id="start-screen">
        <h1>QUIZ! OHTANISAN</h1>
        <p>クイズゲームへようこそ！異なる人物の画像が表示され、2つの選択肢から正しい人物を選びます。各問題には5秒の制限時間があり、全10問です。頑張ってください！</p>
        <img id="start-image" src="" alt="OHTANISAN">
        <button id="start-button">スタート</button>
    </div>

    <div id="game-screen">
        <img id="question-image" src="" alt="問題画像">
        <div id="choices">
            <button id="choice1"></button>
            <button id="choice2"></button>
        </div>
        <div id="timer">残り時間: 5秒</div>
    </div>

    <div id="result-screen">
        <h2>結果</h2>
        <p>あなたのスコア: <span id="score"></span>/10</p>
        <img id="result-image" src="" alt="結果画像">
        <button id="back-to-start">スタートに戻る</button>
    </div>

    <script>
        const categories = {
            OHTANISAN: ['ohtani1.jpg', 'ohtani2.jpg', 'ohtani3.jpg', 'ohtani4.jpg', 'ohtani5.jpg'],
            MIZUTANISAN: ['mizutani1.jpg', 'mizutani2.jpg', 'mizutani3.jpg', 'mizutani4.jpg', 'mizutani5.jpg'],
            ELONSAN: ['elon1.jpg', 'elon2.jpg', 'elon3.jpg', 'elon4.jpg', 'elon5.jpg'],
            TRUMPSAN: ['trump1.jpg', 'trump2.jpg', 'trump3.jpg', 'trump4.jpg', 'trump5.jpg']
        };

        const allCategories = ['OHTANISAN', 'MIZUTANISAN', 'ELONSAN', 'TRUMPSAN'];

        let currentQuestion = 0;
        let score = 0;
        let timerId;
        let selectedCategory;
        let selectedImage;
        let correctAnswer;

        const bgm = document.getElementById('bgm');
        bgm.play().catch(error => {
            console.log("BGM再生に失敗しました:", error);
        });

        // 画像をプリロードする関数
        function preloadImage(url) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.src = url;
                img.onload = () => resolve(img);
                img.onerror = () => reject(new Error(`画像の読み込みに失敗しました: ${url}`));
            });
        }

        // スタート画面の画像を設定
        async function setStartImage() {
            const ohtaniImages = categories['OHTANISAN'];
            const randomOhtaniImage = ohtaniImages[Math.floor(Math.random() * 5)];
            try {
                await preloadImage(randomOhtaniImage);
                document.getElementById('start-image').src = randomOhtaniImage;
            } catch (error) {
                console.error(error);
            }
        }

        // ゲーム画面の画像を設定
        async function setQuestionImage() {
            selectedCategory = allCategories[Math.floor(Math.random() * allCategories.length)];
            selectedImage = categories[selectedCategory][Math.floor(Math.random() * 5)];
            try {
                await preloadImage(selectedImage);
                document.getElementById('question-image').src = selectedImage;
            } catch (error) {
                console.error(error);
            }
        }

        // 結果画面の画像を設定
        async function setResultImage() {
            const randomCategory = allCategories[Math.floor(Math.random() * 4)];
            const randomImage = categories[randomCategory][Math.floor(Math.random() * 5)];
            try {
                await preloadImage(randomImage);
                document.getElementById('result-image').src = randomImage;
            } catch (error) {
                console.error(error);
            }
        }

        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            currentQuestion = 0;
            score = 0;
            nextQuestion();
        }

        async function nextQuestion() {
            if (currentQuestion >= 10) {
                showResult();
                return;
            }
            currentQuestion++;
            await setQuestionImage();
            correctAnswer = selectedCategory;
            const wrongAnswers = allCategories.filter(cat => cat !== correctAnswer);
            const wrongAnswer = wrongAnswers[Math.floor(Math.random() * wrongAnswers.length)];
            const choices = [correctAnswer, wrongAnswer];
            const shuffledChoices = choices.sort(() => Math.random() - 0.5);
            document.getElementById('choice1').textContent = shuffledChoices[0];
            document.getElementById('choice2').textContent = shuffledChoices[1];
            document.getElementById('choice1').disabled = false;
            document.getElementById('choice2').disabled = false;
            let timeLeft = 5;
            document.getElementById('timer').textContent = `残り時間: ${timeLeft}秒`;
            clearTimeout(timerId);  // 既存のタイマーをクリア
            timerId = setTimeout(() => {
                document.getElementById('choice1').disabled = true;
                document.getElementById('choice2').disabled = true;
                nextQuestion();
            }, 5000);
            // タイマーを表示
            const timerDisplay = setInterval(() => {
                timeLeft--;
                if (timeLeft >= 0) {
                    document.getElementById('timer').textContent = `残り時間: ${timeLeft}秒`;
                } else {
                    clearInterval(timerDisplay);
                }
            }, 1000);
        }

        function checkAnswer(selected) {
            clearTimeout(timerId);  // タイマーをクリア
            if (selected === correctAnswer) {
                score++;
            }
            document.getElementById('choice1').disabled = true;
            document.getElementById('choice2').disabled = true;
            nextQuestion();
        }

        async function showResult() {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            document.getElementById('score').textContent = score;
            await setResultImage();
        }

        function backToStart() {
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('start-screen').style.display = 'block';
            setStartImage();
        }

        document.getElementById('start-button').addEventListener('click', startGame);
        document.getElementById('choice1').addEventListener('click', () => {
            if (!document.getElementById('choice1').disabled) {
                checkAnswer(document.getElementById('choice1').textContent);
            }
        });
        document.getElementById('choice2').addEventListener('click', () => {
            if (!document.getElementById('choice2').disabled) {
                checkAnswer(document.getElementById('choice2').textContent);
            }
        });
        document.getElementById('back-to-start').addEventListener('click', backToStart);

        setStartImage();
    </script>
</body>
</html>
