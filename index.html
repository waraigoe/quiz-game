<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUIZ! OHTANISAN</title>
    <style>
        /* スタイルは省略 */
    </style>
</head>
<body>
    <audio id="bgm" loop autoplay>
        <source src="bgm.mp3" type="audio/mpeg">
        あなたのブラウザはオーディオ要素をサポートしていません。
    </audio>

    <div id="start-screen">
        <h1>QUIZ! OHTANISAN</h1>
        <p>Welcome to the quiz game! You will be shown images of different people, and you have to choose who it is from two options. You have 5 seconds to answer each question. There are 10 questions in total. Good luck!</p>
        <img id="start-image" src="" alt="OHTANISAN">
        <button id="start-button">START</button>
    </div>

    <div id="game-screen">
        <img id="question-image" src="" alt="Question Image">
        <div id="choices">
            <button id="choice1"></button>
            <button id="choice2"></button>
        </div>
        <div id="timer">Time left: 5s</div>
    </div>

    <div id="result-screen">
        <h2>Result</h2>
        <p>Your score: <span id="score"></span>/10</p>
        <img id="result-image" src="" alt="Result Image">
        <button id="back-to-start">Back to Start</button>
    </div>

    <script>
        const categories = {
            OHTANISAN: ['ohtani1.jpg', 'ohtani2.jpg', 'ohtani3.jpg', 'ohtani4.jpg', 'ohtani5.jpg'],
            MIZUTANISAN: ['mizutani1.jpg', 'mizutani2.jpg', 'mizutani3.jpg', 'mizutani4.jpg', 'mizutani5.jpg'],
            ELONSAN: ['elon1.jpg', 'elon2.jpg', 'elon3.jpg', 'elon4.jpg', 'elon5.jpg'],
            TRUMPSAN: ['trump1.jpg', 'trump2.jpg', 'trump3.jpg', 'trump4.jpg', 'trump5.jpg']
        };

        const allCategories = ['OHTANISAN', 'MIZUTANISAN', 'ELONSAN', 'TRUMPSAN'];

        let currentQuestion = 0;
        let score = 0;
        let timer;
        let selectedCategory;
        let selectedImage;
        let correctAnswer;

        const bgm = document.getElementById('bgm');
        bgm.play().catch(error => {
            console.log("BGM再生に失敗しました:", error);
        });

        // 画像をプリロードする関数
        function preloadImage(url) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.src = url;
                img.onload = () => resolve(img);
                img.onerror = () => reject(new Error(`画像の読み込みに失敗しました: ${url}`));
            });
        }

        // スタート画面の画像を設定
        async function setStartImage() {
            const ohtaniImages = categories['OHTANISAN'];
            const randomOhtaniImage = ohtaniImages[Math.floor(Math.random() * 5)];
            try {
                await preloadImage(randomOhtaniImage);
                document.getElementById('start-image').src = randomOhtaniImage;
            } catch (error) {
                console.error(error);
            }
        }

        // ゲーム画面の画像を設定
        async function setQuestionImage() {
            selectedCategory = allCategories[Math.floor(Math.random() * allCategories.length)];
            selectedImage = categories[selectedCategory][Math.floor(Math.random() * 5)];
            try {
                await preloadImage(selectedImage);
                document.getElementById('question-image').src = selectedImage;
            } catch (error) {
                console.error(error);
            }
        }

        // 結果画面の画像を設定
        async function setResultImage() {
            const randomCategory = allCategories[Math.floor(Math.random() * 4)];
            const randomImage = categories[randomCategory][Math.floor(Math.random() * 5)];
            try {
                await preloadImage(randomImage);
                document.getElementById('result-image').src = randomImage;
            } catch (error) {
                console.error(error);
            }
        }

        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            currentQuestion = 0;
            score = 0;
            nextQuestion();
        }

        async function nextQuestion() {
            if (currentQuestion >= 10) {
                showResult();
                return;
            }
            currentQuestion++;
            await setQuestionImage();
            correctAnswer = selectedCategory;
            const wrongAnswers = allCategories.filter(cat => cat !== correctAnswer);
            const wrongAnswer = wrongAnswers[Math.floor(Math.random() * wrongAnswers.length)];
            const choices = [correctAnswer, wrongAnswer];
            // 選択肢をシャッフル
            const shuffledChoices = choices.sort(() => Math.random() - 0.5);
            document.getElementById('choice1').textContent = shuffledChoices[0];
            document.getElementById('choice2').textContent = shuffledChoices[1];
            // 選択肢を再有効化
            document.getElementById('choice1').disabled = false;
            document.getElementById('choice2').disabled = false;
            let timeLeft = 5;
            document.getElementById('timer').textContent = `Time left: ${timeLeft}s`;
            clearInterval(timer);  // 既存のタイマーをクリア
            timer = setInterval(() => {
                timeLeft--;
                if (timeLeft >= 0) {
                    document.getElementById('timer').textContent = `Time left: ${timeLeft}s`;
                } else {
                    clearInterval(timer);
                    document.getElementById('choice1').disabled = true;
                    document.getElementById('choice2').disabled = true;
                    nextQuestion();
                }
            }, 1000);
            // 5秒後に選択肢を無効化
            setTimeout(() => {
                document.getElementById('choice1').disabled = true;
                document.getElementById('choice2').disabled = true;
            }, 5000);
        }

        function checkAnswer(selected) {
            clearInterval(timer);  // タイマーをクリア
            if (selected === correctAnswer) {
                score++;
            }
            // 選択肢を無効化
            document.getElementById('choice1').disabled = true;
            document.getElementById('choice2').disabled = true;
            // 即座に次の問題へ移行
            nextQuestion();
        }

        async function showResult() {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            document.getElementById('score').textContent = score;
            await setResultImage();
        }

        function backToStart() {
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('start-screen').style.display = 'block';
            setStartImage();
        }

        // イベントリスナーを設定
        document.getElementById('start-button').addEventListener('click', startGame);
        document.getElementById('choice1').addEventListener('click', () => {
            if (!document.getElementById('choice1').disabled) {
                checkAnswer(document.getElementById('choice1').textContent);
            }
        });
        document.getElementById('choice2').addEventListener('click', () => {
            if (!document.getElementById('choice2').disabled) {
                checkAnswer(document.getElementById('choice2').textContent);
            }
        });
        document.getElementById('back-to-start').addEventListener('click', backToStart);

        // 初回スタート画面にランダムなOHTANISAN画像を設定
        setStartImage();
    </script>
</body>
</html>
